<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../css/styles.css">


    <link rel="apple-touch-icon" sizes="57x57" href="../img/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../img/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../img/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../img/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../img/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../img/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="../img/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../img/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../img/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="../img/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../img/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../img/favicon-16x16.png">
    <link rel="manifest" href="../img/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">    
    

    <title>Escapement Generator</title>
  </head>
  <body>

    <canvas id="canvas"></canvas>


    <div class="d-flex flex-column flex-shrink-0 escapement-controls" id="controls">

      <h1 class="p-2 pb-0 mb-0 fs-4">Graham Pallet</h1>
      <ul class="mb-0 list-unstyled p-2 pb-0">
        <li class="pb-0">
          <button type="button" id="about_button" class="btn btn-light lh-sm px-3 me-2" title="What is this?">About</button>
        </li>
   
      </ul>

      <hr class="m-2">
      <h2 class="p-2 pb-0 mb-0 fs-5">Wheel Settings</h2>

      <ul class="flex-column mb-auto list-unstyled p-2 pb-0">
        <li>
          <input type="range" id="teeth" name="teeth" min="10" max="200" value="30" step="1"/>
          <label for="teeth" id="teeth_label" class="w-100" title="Number of Teeth on Escapment">Teeth: 30</label>
        </li>
        <li>
          <input type="range" id="tooth_height" name="tooth_height" min="0" max="400" value="50" step="1"/>
          <label for="tooth_height" id="tooth_height_label" class="w-100" title="Height of Teeth on Escapment in pixels">Tooth Height: 50</label>
        </li>
        <li>
          <input type="range" id="tooth_angle" name="tooth_angle" min="0" max="30" value="17" step=".5"/>
          <label for="tooth_angle" id="tooth_angle_label" class="w-100" title="Angle from the left side of the tooth to the tip">Tooth Included Angle: 17</label>
        </li>
        <li>
          <input type="range" id="tooth_angle_undercut" name="tooth_angle_undercut" min="80" max="120" value="90" step="1"/>
          <label for="tooth_angle_undercut" id="tooth_angle_undercut_label" class="w-100" title="Angle from the right tooth tip to the base of tooth">Tooth Undercut Angle: 90</label>
        </li>
        <li>
          <input type="range" id="tooth_width" name="tooth_width" min="0" max=".1" value=".02" step="0.005"/>
          <label for="tooth_width" id="tooth_width_label" class="w-100" title="Width of the tooth at the tip ( in radians )">Tooth Width: 0.02</label>
        </li>
        <li>
          <input type="range" id="spokes" name="spokes" min="0" max="12" value="5" step="1"/>
          <label for="spokes" id="spokes_label" class="w-100" title="Total spokes.  Use zero for no spokes">Spokes: 5</label>
        </li>
        
        <li class="d-none">
          <input type="range" id="spoke_padding" name="spoke_padding" min=".03" max=".1" value="0.05" step=".005"/>
          <label for="spoke_padding" id="spoke_padding_label" class="w-100" title="Padding between spokes">Spoke padding: 0.05</label>
        </li> 

        <li>
          <input type="range" id="radius" name="radius" min="10" max="600" value="200"/>
          <label for="radius" id="radius_label" class="w-100" title="Radius of the escapement wheel in pixels.">Radius: 200</label>
        </li>
        <li>
          <button type="button" id="reset_design" class="btn btn-light lh-sm px-3" onclick="window.location.href=''" title="Reset the design to defaults">Reset to defaults</button>

        </li>
      </ul>

      <hr class="m-2">
      <ul class="mb-auto list-unstyled p-2">
        <li class="">
          <button type="button" id="export_svg" class="btn btn-light lh-sm px-2 me-2" title="Export this design as an SVG file.">Export SVG</button>

          <button type="button" id="share_design" class="btn btn-light lh-sm px-3" title="Copies link to this design to your clipboard">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="16" fill="currentColor" class="bi bi-copy" viewBox="0 0 20 16">
              <path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z"/>
            </svg>
            <span>Share</span>
          </button>
        </li>

        <li class="">
          <button type="button" id="save_design" class="btn btn-light lh-sm px-3 me-2" title="Save this design to your browser cookies.">Save</button>
          <button type="button" id="load_design" class="btn btn-light lh-sm px-3" title="Load a saved version." disabled>Load</button>

        </li>
   
    </ul>
    <hr class="m-2">
    </div>    
    





    <div class="flex-column flex-shrink-0 escapement-controls" id="controls-right">
      <h2 class="p-2 pb-0 mb-0 fs-5">Period Measurements</h2>

      <ul class="flex-column mb-auto list-unstyled p-2 pb-0">
        <li>
          <span id="period_label" title="Milleseconds elapsed since last 'tick'"></span>
        </li>
        <li>
          <span id="average_label" title="Average number of milliseconds for last 50 ticks"></span>
        </li>
        <li>
          <input type="range" id="motor_speed" name="motor_speed" min=".01" max="1" value=".66" step="0.05"/>
          <label for="motor_speed" id="motor_speed_label" class="w-100" title="Max Speed at which the motor drives the escapement wheel">Motor speed: 0.66</label>
        </li>
        <li>
          <input type="range" id="motor_torque" name="motor_torque" min="100" max="10000" value="6500" step="10"/>
          <label for="motor_speed" id="motor_torque_label" class="w-100" title="Torque at which the motor drives the escapement wheel">Motor torque: 6500</label>
        </li>

        </ul>

      <hr class="m-2">

      <h2 class="p-2 pb-0 mb-0 fs-5">Pallet Settings</h2>

      <ul class="flex-column mb-auto list-unstyled p-2 pb-0">

      <li>
        <input type="range" id="pallet_fork_width" name="pallet_fork_width" min="1" max="4" value="2.25" step=".05"/>
        <label for="pallet_fork_width" id="pallet_fork_width_label" class="w-100" title="Width of the pallet forks as determined by number of degrees they contain from the center of the esacpement wheel">Pallet Fork Width: 2.25</label>
      </li>

        <li>
          <input type="range" id="pendulum_offset" name="pendulum_offset" min="2.5" max="4" value="3.31" step="0.005"/>
          <label for="pendulum_offset" id="pendulum_offset_label" class="w-100" title="Offset of the pendulum as a ratio of the radius.  Smaller values mean shorter swing and faster period.  Too close and you may stop the wheel!">Pendulum offset: 3.31</label>
        </li>
        <li>
          <input type="range" id="pendulum_radius" name="pendulum_radius" min="10" max="300" value="59" step=".25"/>
          <label for="pendulum_radius" id="pendulum_radius_label" class="w-100" title="Size of the pendulum weight.  Affects the speed at which the pendulum swings and the period of the ticks.">Pendulum radius: 59</label>
        </li>
        <li class="d-none">
          <input type="range" id="pallet_density" name="pallet_density" min=".1" max="1" value=".8" step="0.05"/>
          <label for="pallet_density" id="pallet_density_label" class="w-100" title="Amount of weight distributed through the whole top of the pallet.">Pallet Weight: .8</label>
        </li>
        <li>
          <input type="range" id="pallet_lr" name="pallet_lr" min="-5" max="5" value="3.15" step="0.05"/>
          <label for="pallet_lr" id="pallet_lr_label" class="w-100" title="Counterweight to equalize the period lengths between 'tick' and 'tock'.  ">Pallet Balance: 3.15</label>
        </li>

        <li class="d-none">
          <input type="range" id="pallet_friction" name="pallet_friction" min="0" max="1" value=".2" step="0.01"/>
          <label for="pallet_friction" id="pallet_friction_label" class="w-100" title="Amount of friction the pallet has when touching the escapement wheel.">Pallet friction 0.3</label>
        </li>


      </ul>

      <hr class="m-2">
    </div>    











    <div class="modal" tabindex="-1" id="confirm_modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Remove gear?</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="confirm_modal_btn">Continue</button>
          </div>
        </div>
      </div>
    </div>    

    <div class="modal" tabindex="-1" id="export_modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Export SVG</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Export Escapement as SVG file.  The file will include the gear and the pallet. The pendulum is not included as the dimension, shape, and weight are determined non digitally.</p>
            <p>The distance between the pallet and the gear centers in this export should be kept as is.  It is set to the radius of the Escapment gear times √2 </p>
              
            <p>Choose a name for your file:</p>
            <div class="input-group flex-nowrap">
              <input type="text" class="form-control" id="svg_file_name" aria-label="filename" aria-describedby="addon-wrapping" value="GrahamPallet">
              <span class="input-group-text" id="addon-wrapping">.svg</span>
            </div>
            <!-- <div class="form-check form-switch pt-4">
              <input class="form-check-input" type="checkbox" id="show_pendulum">
              <label class="form-check-label" for="show_pendulum">Include pendulum in svg export?</label>
            </div>   -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="export_all_gears">Export</button>
          </div>
        </div>
      </div>
    </div>    


    <div class="modal" tabindex="-1" id="save_modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Save your Escapement</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Save this escapement to your browser so you can easily retrieve it later.  Give it a unique name so you don't forget!</p>
            <p>Choose a name:</p>
            <div class="input-group flex-nowrap">
              <input type="text" class="form-control" id="escapement_name" aria-label="filename" aria-describedby="addon-wrapping" value="Super Pallet">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="do_save_escapement">Save</button>
          </div>
        </div>
      </div>
    </div>    




    <div class="modal" tabindex="-1" id="load_modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Load Design</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Select a design to retrieve. Alternatively, if you'd like to delete a saved design you may select it and use the 'delete' button.</p>
            <select class="form-select" aria-label="select design" id="design_selector">
              <option selected>Choose</option>
            </select>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger" id="do_delete_escapement">Delete</button>

            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="do_load_escapement">Load</button>
          </div>
        </div>
      </div>
    </div>    



    <div class="modal" tabindex="-1" id="share_modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Copied to clipboard!</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Send this link to anyone for them to share and collaborate with you on your escapement system.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ok!</button>
          </div>
        </div>
      </div>
    </div>   


    <div class="modal" tabindex="-1" id="about_modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">About</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>A Graham Pallet is a type of <a href="https://en.wikipedia.org/wiki/Escapement">escapement</a> that is used to control the release of energy from a system in a time keeping or other device.</p>  
            <p>This page was made to simulate how an escapement might work with different shapes. The simulation uses a 2 dimensional physics engine to simulate the different forces at work in such a device, and in general prevents me from trying something that definitely won't work.  Also, just because it works in this simulation does not mean it would work in real life.</p>
            <p>This tool also provides myself with the ability to export any designs for cutting on a laser cutter or CNC machine.  In the future I hope to add support for other file tipes, specifically DXF format, but for now SVG works for my purposes.</p>
            <p>If you have questions about any of the settings, you can hover your mouse over any of the slider labels and you will get a brief explanation as to what you are changing.</p>

            <p>If you have other questions or suggestions, please use the <a href="https://localhuman.industries/contact/" target="_blank">contact form here</a> to get in touch!</p>
            <p>Inspiration for this tool came from this document: <a href="https://www.abbeyclock.com/EscMechanics.pdf">Escapment Mechanics.</a></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ok!</button>
          </div>
        </div>
      </div>
    </div>       

    <script src="../js/util/bootstrap.bundle.min.js"></script>    

    <script type="module" src="../js/box2d/PhaserBox2D-Debug.js"></script>

 
    <script type="module" src="../js/export.js"></script>
    <script type="module" src="../js/util/intersect.js"></script>
    <script type="module" src="../js/gear.js"></script>
    <script type="module" src="../js/escapement.js"></script>
    <script type="module" src="../js/escapement_main.js"></script>



      
  </body>
</html>
